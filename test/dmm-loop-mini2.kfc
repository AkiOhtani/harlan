;; -*- scheme -*-

;; A part of ense matrix-matrix product
;; use loops instead of nested kernels

(module
  (extern print_2x2_int_vec ((vec (vec int 2) 2)) -> void)
  
  (define (main)
    (let ((B (vector
               (vector 1 0)
               (vector 0 1)))
          (Bt (make-vector 2 (make-vector 2 0))))
      (print_2x2_int_vec B)
      (for (j 0 (length (vector-ref B 0)))
        (let ((io (iota 2)))
          (let ((row (kernel ((i (var io)))
                       (vector-ref (vector-ref B (var j)) (var i)))))
            (vector-set! (var Bt) (var j) (var row)))))
      (print "\n")
      (print_2x2_int_vec Bt)
      (return 0))))
