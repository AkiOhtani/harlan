;; Vector sum

(module
  (extern nanotime () -> u64)

  (define (add_vectors len)
    (let ((X (make-vector len 1))
          (Y (make-vector len 1)))
      (let ((start (nanotime)))
        (let ((Sum (kernel ((x X) (y Y)) (+ x y))))
          (let ((stop (nanotime)))
            (for (m 0 len)
              (assert (= (vector-ref Sum m) 2)))
            (- stop start))))))

  (define (bench_length len)
    (let ((iters 10)
          (ttime 0))
      (for (k 0 iters)
        (set! ttime (+ ttime (add_vectors len))))

      (print len)
      (print "\t")
      (print (/ (/ ttime 1000) iters))
      (print "\n")))
    
  (define (main)
    (for (i 1 100)
      (bench_length (* i 100000)))
    (return 0)))
