;; -*- scheme -*-
;; xfail

;; a kernel using a free variable

(module
  (fn main () (() -> int)
      (let X (vector int) (vector (int 1)))
      (let y int (int 1))
      (kernel (((x int) ((var (vector int) X) (vector int))))
              (set! (var int x) (+ (var int y) (var int x))))
      (assert (= (vector-ref int (var (vector int) X) (int 0)) (int 2)))
      (return (int 0))))
