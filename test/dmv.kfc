;; -*- scheme -*-
;; xfail

;; Dense matrix-vector product

(module
  (fn main ()
      (let M (vector
              (vector 1 0 0 0)
              (vector 0 1 0 0)
              (vector 0 0 1 0)
              (vector 0 0 0 1)))
      (let X (vector 1 2 3 4))
      (let Y (kernel ((row (var M)))
                     (reduce + (kernel ((x (var X)) (y (var row)))
                                       (* (var x) (var y))))))
      (assert (= (var X) (var Y)))
      (return 0)))
